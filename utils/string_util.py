import re


def sql_result_to_csv(s):
    """
    +-----------+-----------+-------+
    |status_code|status_code|    cnt|
    +-----------+-----------+-------+
    |        499|        499|     85|
    |        502|        502|   3677|
    |        504|        504|   7233|
    |        500|        500|     14|
    |        200|        200|5996872|
    |        403|        403|    380|
    |        503|        503| 139826|
    +-----------+-----------+-------+


    status_code,status_code,cnt
    499,499,85
    502,502,3677
    504,504,7233
    500,500,14
    200,200,5996872
    403,403,380
    503,503,139826

    """

    p1 = r'\+-+.*\+'
    p2 = r'\|[\n\r]+'
    p3 = r'\|\s*'
    p4 = r'[\r\n],'
    p5 = r'^,'

    s = s.encode('utf-8')
    for p, repl in [(p1, b''), (p2, b'\n'), (p3, b','), (p4, b'\n'), (p5, b'')]:
        s = re.sub(str.encode(p, encoding='utf-8'), repl, s)

    return s.strip()
